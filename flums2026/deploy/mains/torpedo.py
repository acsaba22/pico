import framebuf
import liblcd
import random
import time
import jobs
import timestats
from timestats import NewTimer
import asyncio
import wifistream

wifistream.SSID = "pico-torpedo"
wifistream.AUTO_TIMEOUT_MS = 15000

BOARD_WIDTH = 10
BOARD_HEIGHT = 10
SHIP_SIZES = [2,2,3,3,4,5]

if 0:
    BOARD_WIDTH = 1
    BOARD_HEIGHT = 1
    SHIP_SIZES = [1]

comm = None


class Text(object):
    def __init__(self, lcd):
        self.sprite = liblcd.Sprite(lcd, 160, 40)
        self.fb = self.sprite.getFramebuffer()
        self.fb.fill(liblcd.RED)
        self.sprite.move(liblcd.Coord(240, 150))

    def set_text(self, text_lines):
        assert len(text_lines) < self.sprite.height // 8
        top = self.sprite.height // 2 - len(text_lines)*4
        self.fb.fill(liblcd.RED)
        for line in text_lines:
            left = max(0, self.sprite.width // 2 - len(line)*4)
            self.fb.text(line, left, top, liblcd.BLACK)
            top += 8
        self.sprite.draw()

    def show(self):
        self.sprite.show()

    def hide(self):
        self.sprite.hide()

class Square(object):

    FACE_EMPTY = 0
    FACE_SHIP = 1
    FACE_SHIP_HIT = 2
    FACE_SHIP_SUNK = 3
    FACE_EMPTY_HIT = 4
    FACE_MARKED = 5

    FACES = {
      FACE_EMPTY: bytearray(b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'),
      FACE_EMPTY_HIT: bytearray(b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\xff\xff\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\xff\xff\xff\xff\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\xff\xff\xff\xff\x05\x1d\x05\x1d\x05\x1d\x05\x1d\xff\xff\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\xff\xff\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\xff\xff\x9e\xdd\x05\x1d\x05\x1d\x05\x1d\x05\x1d\xff\xff\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\xff\xff\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\xff\xff\xff\xff\x05\x1d\x05\x1d\x05\x1d\xff\xff\xff\xff\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\xff\xff\xff\xff\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\xff\xff\xff\xff\x05\x1d\x05\x1d\x05\x1d\x9e\xdd\xff\xff\x05\x1d\x05\x1d\xff\xff\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\xff\xff\xff\xff\xff\xff\x05\x1d\x05\x1d\x05\x1d\xff\xff\xff\xff\xff\xff\x05\x1d\x05\x1d\xff\xff\xff\xff\xff\xff\x05\x1d\x05\x1d\xff\xff\xff\xff\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\xff\xff\xff\xff\x9e\xdd\xff\xff\x05\x1d\x05\x1d\xff\xff\xff\xff\xff\xff\x05\x1d\x05\x1d\xd7\xff\xff\xff\xff\xff\x05\x1d\x05\x1d\xff\xff\xff\xff\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x9e\xdd\xff\xff\x9e\xdd\xff\xff\xff\xff\xff\xff\xff\xff\x9e\xdd\xff\xff\xff\xff\x05\x1d\xd7\xff\x9e\xdd\xd7\xff\x05\x1d\x05\x1d\xff\xff\xd7\xff\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\xff\xff\xd7\xff\x9e\xdd\xff\xff\xd7\xff\xff\xff\xff\xff\x9e\xdd\xff\xff\xff\xff\xd7\xff\xd7\xff\x9e\xdd\xd7\xff\xd7\xff\x05\x1d\xff\xff\xd7\xff\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\xd7\xff\xd7\xff\x9e\xdd\xff\xff\xd7\xff\xff\xff\x9e\xdd\x9e\xdd\x9e\xdd\xff\xff\xd7\xff\xd7\xff\x9e\xdd\xd7\xff\xd7\xff\xff\xff\x9e\xdd\xd7\xff\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\xd7\xff\xff\xff\x9e\xdd\x9e\xdd\xd7\xff\xff\xff\x9e\xdd\x9e\xdd\xff\xff\xff\xff\xd7\xff\x9e\xdd\x9e\xdd\xd7\xff\xd7\xff\xd7\xff\x9e\xdd\xd7\xff\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\xd7\xff\xd7\xff\xd7\xff\x9e\xdd\xd7\xff\xff\xff\x9e\xdd\x9e\xdd\xff\xff\xff\xff\xd7\xff\x9e\xdd\x9e\xdd\xd7\xff\xd7\xff\x9e\xdd\x9e\xdd\xd7\xff\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\xd7\xff\xd7\xff\x9e\xdd\xd7\xff\xd7\xff\x9e\xdd\x9e\xdd\xd7\xff\xd7\xff\xd7\xff\x9e\xdd\x9e\xdd\x9e\xdd\x9e\xdd\x9e\xdd\xd7\xff\xd7\xff\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\xd7\xff\x9e\xdd\x9e\xdd\x9e\xdd\xd7\xff\x9e\xdd\xd7\xff\x9e\xdd\xd7\xff\x9e\xdd\x9e\xdd\xd7\xff\x9e\xdd\xd7\xff\xd7\xff\xd7\xff\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x9e\xdd\x9e\xdd\x9e\xdd\xd7\xff\x9e\xdd\xd7\xff\x9e\xdd\xd7\xff\x9e\xdd\xd7\xff\x9e\xdd\x9e\xdd\xd7\xff\xd7\xff\x9e\xdd\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x9e\xdd\x9e\xdd\x9e\xdd\x9e\xdd\x9e\xdd\x9e\xdd\x9e\xdd\x9e\xdd\xd7\xff\x9e\xdd\xd7\xff\x9e\xdd\x9e\xdd\x9e\xdd\x9e\xdd\x9e\xdd\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x9e\xdd\x9e\xdd\x9e\xdd\xd7\xff\x9e\xdd\x9e\xdd\x9e\xdd\x9e\xdd\x9e\xdd\x9e\xdd\xd7\xff\x9e\xdd\x9e\xdd\x9e\xdd\x9e\xdd\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x9e\xdd\x9e\xdd\xd7\xffm\xdf\x9e\xdd\x9e\xdd\x9e\xdd\x9e\xdd\x9e\xdd\x9e\xdd\x9e\xdd\x9e\xdd\x9e\xdd\x9e\xdd\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x9e\xdd\x9e\xdd\x9e\xddm\xdfm\xdf\x9e\xdd\x9e\xddm\xdfm\xdfm\xdfm\xdfm\xdfm\xdfm\xdf\x9e\xdd\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x9e\xddm\xdfm\xdfm\xdfm\xdfm\xdfm\xdfm\xdfm\xdf\x9e\xdd\x9e\xdd\x9e\xdd\x9e\xdd\x9e\xddm\xdfm\xdfm\xdf\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1dm\xdfm\xdf\x9e\xdd\x9e\xddm\xdfm\xdf\x9e\xdd\x9e\xddm\xdf\x9e\xdd\x9e\xddm\xdfm\xdfm\xdfm\xdfm\xdfm\xdf\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1dm\xdfm\xdfm\xdf\x9e\xddm\xdf\x9e\xddm\xdfm\xdfm\xdfm\xdfm\xdf\x05\x1d\x05\x1d\x05\x1dm\xdfm\xdf\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1dm\xdfm\xdfm\xdfm\xdfm\xdf\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x05\x1d\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'),

      FACE_SHIP: bytearray(b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\xc6\x18\xc6\x18\xc6\x18:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\xc6\x18\xc6\x18\xc6\x18\xc6\x18\xc6\x18:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y\xc6\x18\xc6\x18{\xef{\xef{\xef\xc6\x18\xc6\x18:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y\xc6\x18\xc6\x18{\xef{\xef{\xef\xc6\x18\xc6\x18:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y\xc6\x18\xc6\x18{\xef{\xef{\xef\xc6\x18\xc6\x18:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\xc6\x18\xc6\x18\xc6\x18\xc6\x18\xc6\x18:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\xc6\x18\xc6\x18\xc6\x18:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'),
      FACE_SHIP_HIT: bytearray(b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y\xc6\x18\xc6\x18\xfb\xe4\xc6\x18:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y\xff\x80\xff\x80\xfb\xe4\xc6\x18\xff\x80:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y\xc6\x18\xfb\xe4\xff\x80\xfb\xe4\xff\x80:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y\xff\x80\xe8\xe4\xe8\xe4\xff\x80\xfb\xe4:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y\xc6\x18\xe8\xe4\xfb\xe4\xc6\x18\xff\x80\xc6\x18:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y\xfb\xe4\xe8\xe4\xc6\x18:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y\xe8\xe4\xc6\x18:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y\xc6\x18:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y\xe8\xe4\xfeA\xfeA\xc6\x18\xc6\x18:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y\xfeA\xc6\x18\xfb\xe4\xfb\xe4\xc6\x18\xc6\x18:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y\xc6\x18\xc6\x18\xff\x80{\xef\xe8\xe4\xe8\xe4\xc6\x18:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y\xc6\x18\xfb\xe4\xff\x80\xe8\xe4{\xef\xe8\xe4\xc6\x18:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y\xe8\xe4\xfb\xe4\xff\x80\xe8\xe4{\xef\xc6\x18\xff\x80\xff\x80:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\xfb\xe4\xfb\xe4\xfb\xe4\xff\x80\xff\x80\xff\x80:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\xc6\x18\xc6\x18\xfb\xe4:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\xe8\xe4\xe8\xe4:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\xe8\xe4\xff\x80\xc6\x18:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\xc6\x18\xc6\x18\xe8\xe4\xff\x80\xc6\x18\xc6\x18:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\xe8\xe4\xe8\xe4\xe8\xe4\xff\x80\xff\x80\xff\x80:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\xc6\x18\xfb\xe4\xfb\xe4\xc6\x18:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\xff\x80\xff\x80\xc6\x18\xfb\xe4:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\xc6\x18\xfb\xe4\xfb\xe4:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\xc6\x18\xc6\x18\xc6\x18:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'),
      FACE_SHIP_SUNK: bytearray(b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y\xfb\xe4\xe8\xe4\xe8\xe4\xc6\x18\xc6\x18:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y\xff\x80\xc6\x18\xe8\xe4\xff\x80\xfb\xe4\xc6\x18\xff\x80\xe8\xe4:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y\xff\x80\xff\x80\xe8\xe4\xff\x80\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y\xc6\x18\xe8\xe4\xc6\x18\xff\x80\xe8\xe4\xff\x80:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y\xe8\xe4\xfb\xe4\xfb\xe4:Y\xc6\x18\xff\x80:Y:Y:Y:Y:Y:Y:Y:Y:Y\xe8\xe4\xe8\xe4\xfb\xe4:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y\xfb\xe4\xfb\xe4:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\xc6\x18\xff\x80\xff\x80:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y\xe8\xe4\xfeA\xfeA\xc6\x18\xc6\x18:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y\xfb\xe4:Y:Y:Y:Y:Y:Y\xfeA\xc6\x18\xfb\xe4\xfb\xe4\xc6\x18\xc6\x18:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y\xfb\xe4\xc6\x18:Y:Y:Y:Y:Y\xc6\x18\xc6\x18\xff\x80{\xef\xe8\xe4\xe8\xe4\xc6\x18:Y:Y:Y\xfb\xe4:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y\xc6\x18\xe8\xe4\xff\x80:Y:Y:Y:Y\xc6\x18\xfb\xe4\xff\x80\xe8\xe4{\xef\xe8\xe4\xc6\x18:Y:Y:Y\xc6\x18\xe8\xe4\xc6\x18:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y\xff\x80\xc6\x18:Y:Y:Y\xe8\xe4\xfb\xe4\xff\x80\xe8\xe4{\xef\xc6\x18\xff\x80\xff\x80:Y:Y:Y\xfb\xe4\xff\x80:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y\xc6\x18\xe8\xe4\xe8\xe4\xc6\x18:Y:Y:Y:Y\xfb\xe4\xfb\xe4\xfb\xe4\xff\x80\xff\x80\xff\x80:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y\xff\x80\xff\x80\xff\x80\xe8\xe4\xc6\x18:Y:Y:Y:Y:Y\xc6\x18\xc6\x18\xfb\xe4:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y\xc6\x18\xc6\x18\xc6\x18:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y\xc6\x18\xff\x80\xff\x80\xc6\x18:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y\xfb\xe4\xfb\xe4\xe8\xe4\xc6\x18\xc6\x18:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y\xc6\x18\xe8\xe4\xe8\xe4\xe8\xe4\xc6\x18\xfb\xe4\xc6\x18\xc6\x18\xff\x80:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y\xc6\x18\xfb\xe4\xfb\xe4\xfb\xe4\xfb\xe4\xfb\xe4\xff\x80\xff\x80:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y\xc6\x18\xe8\xe4\xe8\xe4\xff\x80\xfb\xe4\xff\x80\xc6\x18:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y\xc6\x18\xc6\x18\xc6\x18\xfb\xe4\xc6\x18:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y:Y\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'),

      FACE_MARKED: bytearray(b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xe8\xe4\xff\xff\xff\xff\x00\x00\x00\x00\xff\xff\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xff\xff\x00\x00\x00\x00\xff\xff\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xff\xff\x00\x00\x00\x00\xff\xff\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xff\xff\x00\x00\x00\x00\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xff\xff\xff\xff\x00\x00\x00\x00\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xff\xff\xff\xff\x00\x00\x00\x00\xff\xff\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xff\xff\x00\x00\x00\x00\xff\xff\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xff\xff\x00\x00\x00\x00\xff\xff\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xff\xff\x00\x00\x00\x00\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xe8\xe4\xff\xff\xff\xff\x00\x00\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'),
    }
    FB_MAYBE = bytearray(b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xff\xff\xff\xff\xff\xff\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xff\xff\xff\xff\xff\xff\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xff\xff\xff\xff\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xff\xff\xff\xff\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\x00\x00\x00\x00\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\x00\x00\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xff\xff\xff\xff\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xff\xff\xff\xff\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xff\xff\xff\xff\xff\xff\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xff\xff\xff\xff\xff\xff\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe8\xe4\xe8\xe4\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00')
    WIDTH, HEIGHT = 30, 30

    def __init__(self, lcd, x, y):
        self.x, self.y = x, y
        x1, y1 = x*(Square.WIDTH-1)+10, y*(Square.HEIGHT-1)+10
        x2, y2 = x1+Square.WIDTH-1, y1+Square.HEIGHT-1
        self.lcd = lcd
        self._sprite_box = liblcd.Box(x1, x2, y1, y2)
        self._touch_area = liblcd.Box(x1+2, x2+2, y1-2, y2-2)
        self.setFace(Square.FACE_EMPTY)

    def setFace(self, face):
        self.face = face
        self.lcd.ShowBufferAtBox(
            self._sprite_box,
            Square.FACES[self.face])

    def isHit(self):
        return self.face in (Square.FACE_SHIP_HIT, Square.FACE_EMPTY_HIT, Square.FACE_SHIP_SUNK)

    def draw(self):
        self.setFace(self.face)

    def setMaybe(self, maybe):
        if maybe:
            buf = Square.FACES[self.face][:]
            fb = framebuf.FrameBuffer(buf, Square.WIDTH, Square.HEIGHT, framebuf.RGB565)
            fb_maybe = framebuf.FrameBuffer(Square.FB_MAYBE, Square.WIDTH, Square.HEIGHT, framebuf.RGB565)
            fb.blit(fb_maybe, 0, 0, 0xffff)
            self.lcd.ShowBufferAtBox(
                self._sprite_box,
                buf)
        else:
            self.lcd.ShowBufferAtBox(
                self._sprite_box,
                Square.FACES[self.face])

    def isTouch(self, touch):
        return touch in self._touch_area


class Ship(object):
    def __init__(self, size, x, y, is_horizontal):
        self.size = size
        self.x = x
        self.y = y
        self.is_horizontal = is_horizontal
        self.lives = size

    def getCoords(self):
        if self.is_horizontal:
            return [(self.x+i,self.y) for i in range(self.size)]
        else:
            return [(self.x,self.y+i) for i in range(self.size)]

    def isAlive(self):
        return self.lives>0

    def lifeLost(self):
        self.lives -= 1

    @staticmethod
    def GetRandomShip(size):
        is_horizontal = random.choice([True, False])
        if is_horizontal:
            x = random.randint(0, BOARD_WIDTH-size)
            y = random.randint(0, BOARD_HEIGHT-1)
        else:
            x = random.randint(0, BOARD_WIDTH-1)
            y = random.randint(0, BOARD_HEIGHT-size)
        return Ship(size, x, y, is_horizontal)

    @staticmethod
    def CheckTooClose(old_ship, new_ship):
        old_coords = set(old_ship.getCoords())
        new_coords = set(new_ship.getCoords())
        for x, y in old_coords:
            for dx in range(-1, 2):
                for dy in range(-1, 2):
                    if (x+dx, y+dy) in new_coords:
                        return True
        return False

    @staticmethod
    def randomizeShips():
        valid_layout = False
        while not valid_layout:
            ships = []
            valid_layout = True
            for size in SHIP_SIZES:
                new_ship = Ship.GetRandomShip(size)
                too_close = False
                for old_ship in ships:
                    if Ship.CheckTooClose(old_ship, new_ship):
                        too_close = True
                        break
                if too_close:
                    valid_layout = False
                    break
                ships.append(new_ship)
        if valid_layout:
            return ships
        return None

class ShotResult(object):
    def __init__(self, x, y, valid, is_hit, is_sunk, lost):
        self.x = x
        self.y = y
        self.valid = valid
        self.is_hit = is_hit
        self.is_sunk = is_sunk or set()
        self.lost = lost

    def __repr__(self):
        return f"({self.x},{self.y}) valid={self.valid} hit={self.is_hit} sunk={self.is_sunk} lost={self.lost}"

    def __str__(self):
        return f"ShotResult({self.x},{self.y},{self.valid},{self.is_hit},{self.is_sunk},{self.lost})"

class Board(object):
    def __init__(self, lcd, text):
        self.board = [[Square(lcd, x, y) for x in range(BOARD_WIDTH)] for y in range(BOARD_HEIGHT)]
        self.lcd = lcd
        self.text = text
        self.last_maybe = None

    def placeShip(self, ship):
        for x, y in ship.getCoords():
            self.board[y][x].setFace(Square.FACE_SHIP)

    def hasShip(self, x, y):
        for ship in self.ships:
            if (x,y) in ship.getCoords():
                return True
        return False

    def getSquare(self, x, y):
        return self.board[y][x]

    def setMaybe(self, x, y, is_maybe):
        if is_maybe and self.last_maybe == (x,y):
            return
        if self.last_maybe:
            last_x, last_y = self.last_maybe
            self.board[last_y][last_x].setMaybe(False)
            self.last_maybe = None
        if is_maybe and 0<=x<BOARD_WIDTH and 0<=y<BOARD_HEIGHT:
            self.board[y][x].setMaybe(is_maybe)
            self.last_maybe = (x,y)

    def applyShotResult(self, shot_result):
        if shot_result.valid:
            square = self.getSquare(shot_result.x, shot_result.y)
            if shot_result.is_hit:
                square.setFace(Square.FACE_SHIP_HIT)
            else:
                square.setFace(Square.FACE_EMPTY_HIT)
            for (x,y) in shot_result.is_sunk:
                self.board[y][x].setFace(Square.FACE_SHIP_SUNK)

    def shot(self, x, y):
        found_ship = False
        valid_hit = False
        is_hit = False
        is_sunk = set()
        for ship in self.ships:
            if (x,y) in ship.getCoords():
                square = self.board[y][x]
                found_ship = True
                is_hit = True
                if not square.isHit():
                    valid_hit = True
                    ship.lifeLost()
                    if ship.isAlive():
                        square.setFace(Square.FACE_SHIP_HIT)
                    else:
                        for x, y in ship.getCoords():
                            self.board[y][x].setFace(Square.FACE_SHIP_SUNK)
                if not ship.isAlive():
                    is_sunk = ship.getCoords()
        if not found_ship:
            square = self.board[y][x]
            if not square.isHit():
                square.setFace(Square.FACE_EMPTY_HIT)
                valid_hit = True
        lost = not any(ship.isAlive() for ship in self.ships)
        shot_result = ShotResult(x, y, valid_hit, is_hit, is_sunk, lost)
        return shot_result

    # Returns the clicked Square after click, otherwise None
    def checkTouch(self, touch_point):
        if touch_point:
            touch_coord = liblcd.Coord(touch_point[0], touch_point[1])
            found = False
            for row in self.board:
                for square in row:
                    if square.isTouch(touch_coord):
                        return (square.x, square.y)
        return None

    def showLabel(self):
        LABEL_WIDTH = 100
        LABEL_HEIGHT = 30
        LABEL_X = 340
        LABEL_Y = 40
        EXPECTED_FB_SIZE = liblcd.getImageBytesize(LABEL_WIDTH, LABEL_HEIGHT)

        buf = bytearray(EXPECTED_FB_SIZE)
        left = (LABEL_WIDTH - 8*len(self.text)) // 2
        top = LABEL_HEIGHT // 2
        fb = framebuf.FrameBuffer(buf, LABEL_WIDTH, LABEL_HEIGHT, framebuf.RGB565)
        fb.fill(liblcd.WHITE)
        fb.text(self.text, left, top, liblcd.BLACK)
        self.lcd.ShowBufferAtBox(
                liblcd.Box(LABEL_X, LABEL_X+LABEL_WIDTH-1, LABEL_Y, LABEL_Y+LABEL_HEIGHT-1),
                buf)

    def show(self):
        for row in self.board:
            for square in row:
                square.draw()
        self.showLabel()

class Player(object):
    def __init__(self, self_board):
        self.board = self_board
        self.ships = set()
        self.hits = set()

    async def hint(self, x, y):
        self.board.setMaybe(x,y,True)

    async def shot(self, x, y):
        self.board.setMaybe(x,y,False)
        is_hit = False
        is_sunk = set()
        lost = False
        valid = (x,y) not in self.hits
        if valid:
            self.hits.add((x,y))
            for ship in self.ships:
                if (x,y) in ship.getCoords():
                    is_hit = True
                    ship.lifeLost()
                    if not ship.isAlive():
                        is_sunk = ship.getCoords()
            lost = not any(ship.isAlive() for ship in self.ships)
        shot_result = ShotResult(x, y, valid, is_hit, is_sunk, lost)
        self.board.applyShotResult(shot_result)
        return shot_result

    def stepResult(self, shot_result):
        pass

    async def do(self):
        pass

    async def myStep(self, touch):
        assert False, "unimplemented"

    def show(self):
        self.board.show()

    def your_turn(self):
        """This is called, when this is the this players turn."""
        pass

class Human(Player):
    def __init__(self, lcd, fire_button, mark_button, other_board):
        Player.__init__(self, Board(lcd, "Human"))
        self.fire_button = fire_button
        self.mark_button = mark_button
        self.other_board = other_board
        self.ships = Ship.randomizeShips()
        for ship in self.ships:
            self.board.placeShip(ship)
        self.last_touched = None
        self.marking = False
        self.marking_face = None

    async def myStep(self, touch):
        t = touch.get()
        if self.mark_button.do(t):
            self.marking = not self.marking
            if not self.marking:
                self.mark_button.setText("Mark")
            else:
                self.mark_button.setText("Marking")
            self.last_touched = None
            self.marking_face = None
            return (-1, -1, False)
        if self.marking:
            # Released, last_touched is the clicked
            clicked = self.other_board.checkTouch(t)
            if clicked:
                last_x, last_y = clicked
                square = self.other_board.getSquare(last_x, last_y)
                if self.marking_face is None:
                    if square.face == Square.FACE_EMPTY:
                        square.setFace(Square.FACE_MARKED)
                        self.marking_face = square.face
                    elif square.face == Square.FACE_MARKED:
                        square.setFace(Square.FACE_EMPTY)
                        self.marking_face = square.face
                if self.last_touched != clicked:
                    if square.face in (Square.FACE_EMPTY, Square.FACE_MARKED):
                        square.setFace(self.marking_face)
            else:
                self.marking_face = None
            self.last_touched = clicked
            return None
        elif self.fire_button.do(t) and self.last_touched:
            # Released, last_touched is the clicked
            last_x, last_y = self.last_touched
            self.last_touched = None
            return (last_x, last_y, True)  # Return shot
        if t:
            clicked = self.other_board.checkTouch(t)
            if clicked == self.last_touched:
                # No change
                return None
            if clicked:
                self.last_touched = clicked
                x, y = clicked
                return (x, y,False)  # Return hint
        return None

    def your_turn(self):
        """This is called, when this is the this players turn."""
        Player.your_turn(self)
        self.fire_button.draw()
        self.mark_button.draw()

class BasicAIOpponent(Player):
    def __init__(self, lcd):
        Player.__init__(self, Board(lcd, "Computer"))
        self.ships = Ship.randomizeShips()
        self.last_action = None

    def _guess(self):
        x = random.randint(0, BOARD_WIDTH-1)
        y = random.randint(0, BOARD_HEIGHT-1)
        return (x,y)

    async def myStep(self, touch):
        if self.last_action is None:
            self.last_action = ("AIM", None, time.ticks_ms())
            return None
        last_action_type, coord, last_action_time = self.last_action
        elapsed = (time.ticks_diff(time.ticks_ms(), last_action_time))
        if last_action_type == "AIM":
            if elapsed < 1000:
                return None
            x, y = self._guess()
            self.last_action = ("HINT", (x,y), time.ticks_ms())
            return (x,y,False)  # Return a hint
        if last_action_type == "HINT":
            if elapsed < 1000:
                return None
            self.last_action = None
            x, y = coord
            return (x,y,True)  # Return a shot
        print("invalid action")
        self.last_action = None
        return None

class AIOpponent(BasicAIOpponent):
    def __init__(self, lcd):
        BasicAIOpponent.__init__(self, lcd)
        self.remaining = set(
            (x,y) for x in range(BOARD_WIDTH) for y in range(BOARD_HEIGHT)
        )
        self.opponent_ship_locations = set()
        self.hits = set()

    def _guess(self):
        if not self.remaining:
            print ("Impossible state")
            return (1,1)
        l = list(self.remaining)
        if self.opponent_ship_locations:
            candidates = set()
            for x, y in self.opponent_ship_locations:
                for dx in (-1,1):
                    candidates.add((x+dx,y))
                for dy in (-1,1):
                    candidates.add((x,y+dy))
            candidates.intersection_update(self.remaining)
            if candidates:
                # Prefer shooting near ship
                l = list(candidates)
            else:
                print ("Impossible ships: ", self.opponent_ship_locations)
        index = random.randint(0, len(l)-1)
        next = l[index]
        self.remaining.remove(next)
        return next

    def stepResult(self, shot_result):
        if not shot_result.valid:
            return
        if shot_result.lost:
            return
        if shot_result.is_hit:
            x, y = shot_result.x, shot_result.y
            # Clean up 
            for dx in (-1, 1):
                for dy in (-1, 1):
                    self.remaining.discard((x+dx,y+dy))
            self.opponent_ship_locations.add((x,y))
        if shot_result.is_sunk:
            # remove all
            for x, y in shot_result.is_sunk:
                self.opponent_ship_locations.remove((x,y))
                for dx in (-1, 1):
                    for dy in (-1, 1):
                        self.remaining.discard((x+dx,y+dy))

class NetworkRemoteOpponent(Player):
    def __init__(self, lcd):
        Player.__init__(self, Board(lcd, "Remote"))

    async def hint(self, x, y):
        # Send (HINT,x,y)
        await Player.hint(self,x,y)
        comm.send(f"HINT False,{x},{y}")

    async def shot(self, x, y):
        # Send (SHOT,x,y)
        comm.send(f"SHOT True,{x},{y}")
        # Receive: ShotResult object (blocking)
        recv = await comm.receiveBlocking()
        while True:
            if " " not in recv:
                print("Invalid packet: ", recv)
                continue
            header, packet = recv.split(" ", 1)
            if header not in ("SHOT_RESULT"):
                print("Invalid header: ", recv)
                continue
            break

        shot_result = eval(packet)
        self.board.applyShotResult(shot_result)
        return shot_result

    async def myStep(self, touch):
        recv = comm.receive()
        # Receive (HINT/SHOT,x,y) or None
        if not recv:
            return None
        if " " not in recv:
            print("Invalid packet: ", recv)
            return None
        header, packet = recv.split(" ", 1)
        if header not in ("HINT", "SHOT"):
            print("Invalid header: ", recv)
            return None
        is_final, x, y = eval(packet)

        return (x,y,is_final)

    def stepResult(self, shot_result):
        # SEND (SHOT_RESULT, shot_result)
        packet = str(shot_result)
        comm.send("SHOT_RESULT " + packet)
        pass

async def isFirstPlayer():
    while True:
        token = "HANDSHAKE %04x" % random.randint(0,65535)
        comm.send(token)
        while True:
            other_token = await comm.receiveBlocking()
            if other_token.startswith("HANDSHAKE "):
                break
            print("Invalid packed received: ", other_token)            

        if other_token == token:
            continue
        return token < other_token

async def mainTorpedo():
    global comm, remote_play
    screen = liblcd.LCD_3inch5()
    screen.BackLight(40)
    touch = liblcd.SmartTouch(screen)

    text_box = Text(screen)
    screen.Clear()

    fire_button = liblcd.Button3D(screen, liblcd.Box(340, 440, 220, 270), text="Fire", visible=False)
    mark_button = liblcd.Button3D(screen, liblcd.Box(340, 440, 150, 200), text="Mark", visible=False)

    button_singleplay = liblcd.Button3D(screen, liblcd.Box(140, 340, 100, 149), text="Single Player", visible=False)
    button_networkplay = liblcd.Button3D(screen, liblcd.Box(140, 340, 170, 219), text="Network Mode", visible=False)

    while True:
        screen.Clear()
        button_singleplay.draw()
        button_networkplay.draw()
        # Mode selection screen
        while True:
            await asyncio.sleep_ms(50)
            t = touch.get()
            if button_singleplay.do(t):
                remote_play = False
                break
            if button_networkplay.do(t):
                remote_play = True
                break

        screen.Clear()

        is_first_play = False
        if remote_play:
            text_box.set_text(["Waiting for", "connection..."]);
            text_box.show()
            if not comm:
                comm = wifistream.WifiStream(wifistream.Mode.AUTO)
                jobs.start(comm.connectAndStartJobs())
            is_first_play = await isFirstPlayer()
            text_box.hide()
            opponent = NetworkRemoteOpponent(screen)
        else:
            opponent = AIOpponent(screen)
        player = Human(screen, fire_button, mark_button, opponent.board)

        if is_first_play:
            players = [player, opponent]
        else:
            players = [opponent, player]


        players[-1].show()
        players[0].your_turn()

        while True:
            await asyncio.sleep_ms(50)
            for player in players:
                await player.do()
            touch.do()
            clicked = await players[0].myStep(touch)
            if clicked:
                x, y, is_shot = clicked
                if is_shot:
                    shot_result = await players[-1].shot(x, y)
                    players[0].stepResult(shot_result)
                    # print (shot_result)
                    if shot_result.valid:
                        if shot_result.lost:
                            # Player lost.
                            break
                        await asyncio.sleep(1)
                        players = [players[1], players[0]]
                        screen.Clear()
                        # We show the other board
                        players[-1].show()
                        players[0].your_turn()
                else:
                    await players[-1].hint(x, y)
        
        text_box.set_text([players[0].board.text, "Won"])
        text_box.show()

        while screen.TouchGet():
            pass
        while not screen.TouchGet():
            pass
        text_box.hide()


async def run():
    jobs.start(mainTorpedo())
    await jobs.STOP.wait()

def main():
    jobs.runMain(run())

if __name__ == '__main__':
    jobs.runMain(run())
